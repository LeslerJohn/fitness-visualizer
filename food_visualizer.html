<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal-Based Food Recommendations - Diet Templates</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #2ecc71 0%, #3498db 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .controls {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .preference-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .preference-group {
            display: flex;
            flex-direction: column;
        }

        .preference-group label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 14px;
        }

        .preference-group select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            background: white;
        }

        .preference-group select:focus {
            border-color: #2ecc71;
            outline: none;
        }

        .template-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
            color: #2c3e50;
        }

        .meals-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .meal-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .meal-header {
            padding: 20px;
            color: white;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .breakfast-header { background: linear-gradient(135deg, #ff9800, #f57c00); }
        .lunch-header { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .dinner-header { background: linear-gradient(135deg, #9c27b0, #7b1fa2); }
        .snacks-header { background: linear-gradient(135deg, #4caf50, #388e3c); }

        .meal-foods {
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        .food-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #2ecc71;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .food-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .food-name {
            font-size: 14px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .food-category {
            background: #3498db;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            display: inline-block;
            margin-bottom: 10px;
        }

        .macros-display {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 10px 0;
        }

        .macro-item {
            text-align: center;
            padding: 8px;
            border-radius: 6px;
            font-size: 11px;
        }

        .calories-macro {
            background: #e8f5e8;
            color: #27ae60;
        }

        .protein-macro {
            background: #e3f2fd;
            color: #1976d2;
        }

        .carbs-macro {
            background: #fff3e0;
            color: #f57c00;
        }

        .fat-macro {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .macro-label {
            font-weight: bold;
            font-size: 9px;
            text-transform: uppercase;
        }

        .macro-value {
            font-weight: bold;
            margin-top: 2px;
        }

        .meal-summary {
            background: #e8f5e8;
            padding: 15px;
            margin: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .summary-title {
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .summary-macros {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .summary-macro {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 2px solid #27ae60;
        }

        .summary-macro-label {
            font-size: 10px;
            color: #27ae60;
            font-weight: bold;
            text-transform: uppercase;
        }

        .summary-macro-value {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
        }

        .loading, .no-results {
            text-align: center;
            padding: 60px 20px;
            color: white;
            font-size: 18px;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .template-details {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .template-id {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .template-stats {
            font-size: 14px;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .meals-container {
                grid-template-columns: 1fr;
            }
            
            .preference-selector {
                grid-template-columns: 1fr;
            }

            .macros-display {
                grid-template-columns: 1fr 1fr;
            }

            .summary-macros {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è Meal-Based Food Recommendations</h1>
            <p>Personalized Diet Templates by User Preference</p>
            <p><strong>‚úÖ Template-Based ‚Ä¢ üéØ Macro Tracking ‚Ä¢ üìä Meal Organization</strong></p>
        </div>

        <div class="controls">
            <div class="preference-selector">
                <div class="preference-group">
                    <label for="somatotype-select">üß¨ Somatotype:</label>
                    <select id="somatotype-select">
                        <option value="">Select Somatotype</option>
                        <option value="ectomorph">Ectomorph</option>
                        <option value="mesomorph">Mesomorph</option>
                        <option value="endomorph">Endomorph</option>
                        <option value="ecto-meso">Ecto-Mesomorph</option>
                        <option value="meso-endo">Meso-Endomorph</option>
                        <option value="endo-ecto">Endo-Ectomorph</option>
                    </select>
                </div>
                <div class="preference-group">
                    <label for="gender-select">‚ö• Gender:</label>
                    <select id="gender-select">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="preference-group">
                    <label for="goal-select">üéØ Goal:</label>
                    <select id="goal-select">
                        <option value="">Select Goal</option>
                        <option value="weight_loss">Weight Loss</option>
                        <option value="weight_gain">Weight Gain</option>
                        <option value="muscle_gain">Muscle Gain</option>
                        <option value="maintenance">Maintenance</option>
                    </select>
                </div>
                <div class="preference-group">
                    <label for="activity-select">üèÉ Activity Level:</label>
                    <select id="activity-select">
                        <option value="">Select Activity</option>
                        <option value="sedentary">Sedentary</option>
                        <option value="lightly_active">Lightly Active</option>
                        <option value="moderately_active">Moderately Active</option>
                        <option value="very_active">Very Active</option>
                        <option value="extremely_active">Extremely Active</option>
                    </select>
                </div>
                <div class="preference-group">
                    <label for="experience-select">üí™ Experience:</label>
                    <select id="experience-select">
                        <option value="">Select Experience</option>
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="hard">Advanced</option>
                    </select>
                </div>
                <div class="preference-group">
                    <label for="location-select">üè† Location:</label>
                    <select id="location-select">
                        <option value="">Select Location</option>
                        <option value="gym">Gym</option>
                        <option value="bodyweight">Home/Bodyweight</option>
                    </select>
                </div>
            </div>
            
            <div class="template-info" id="template-info">
                üîç Select your preferences to view matching food recommendations
            </div>
        </div>

        <div id="results-container">
            <div class="loading">üìã Select your preferences to see personalized meal recommendations...</div>
        </div>
    </div>

    <script>
        // Global variables
        let allTemplates = [];
        let allFoods = [];
        let currentTemplate = null;
        let matchingFoods = {};

        // Load data from files
        async function loadData() {
            try {
                console.log('üîÑ Loading templates and food database...');
                
                // Load templates
                const templateResponse = await fetch('./fixed_comprehensive_diet_templates_with_proper_exercise_ids.csv');
                if (!templateResponse.ok) {
                    throw new Error(`Failed to load templates: ${templateResponse.status}`);
                }
                const templateCsvText = await templateResponse.text();
                console.log('‚úÖ Templates loaded');
                
                // Load food database
                const foodResponse = await fetch('./data/datasets/diet/fndds_processed/optimized_diet_recommendation_database.csv');
                if (!foodResponse.ok) {
                    throw new Error(`Failed to load food database: ${foodResponse.status}`);
                }
                const foodCsvText = await foodResponse.text();
                console.log('‚úÖ Food database loaded');
                
                // Parse data
                allTemplates = parseCSVData(templateCsvText);
                allFoods = parseCSVData(foodCsvText);
                console.log('‚úÖ Parsed:', allTemplates.length, 'templates and', allFoods.length, 'foods');
                
                // Create food lookup map for faster access
                createFoodLookupMap();
                
                // Setup event listeners
                setupEventListeners();
                
            } catch (error) {
                console.error('‚ùå Error loading data:', error);
                document.getElementById('results-container').innerHTML = `
                    <div class="error">
                        ‚ùå Error loading data: ${error.message}
                        <br><br>Please ensure these files exist:
                        <br>‚Ä¢ fixed_comprehensive_diet_templates_with_proper_exercise_ids.csv
                        <br>‚Ä¢ data/datasets/diet/fndds_processed/optimized_diet_recommendation_database.csv
                    </div>
                `;
            }
        }

        function parseCSVData(csvString) {
            const lines = csvString.trim().split('\n');
            const headers = lines[0].split(',');
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = [];
                let currentValue = '';
                let insideQuotes = false;
                
                for (let j = 0; j < lines[i].length; j++) {
                    const char = lines[i][j];
                    if (char === '"' && (j === 0 || lines[i][j-1] === ',')) {
                        insideQuotes = true;
                    } else if (char === '"' && (j === lines[i].length - 1 || lines[i][j+1] === ',')) {
                        insideQuotes = false;
                    } else if (char === ',' && !insideQuotes) {
                        values.push(currentValue.trim().replace(/"/g, ''));
                        currentValue = '';
                    } else {
                        currentValue += char;
                    }
                }
                values.push(currentValue.trim().replace(/"/g, ''));
                
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index] || '';
                });
                data.push(row);
            }
            return data;
        }

        function createFoodLookupMap() {
            matchingFoods = {};
            allFoods.forEach(food => {
                const foodName = food.Food_Item.toLowerCase().trim();
                matchingFoods[foodName] = food;
                
                // Also create partial matches for better food matching
                const words = foodName.split(/\s+/);
                if (words.length > 2) {
                    // Create key from first 2-3 significant words
                    const shortKey = words.slice(0, 3).join(' ');
                    if (!matchingFoods[shortKey]) {
                        matchingFoods[shortKey] = food;
                    }
                }
            });
        }

        function mapSomatotype(selectedSomatotype) {
            // Map the 6-class somatotype to the template somatotype values
            const somatypeMapping = {
                'ectomorph': 'ectomorph',
                'mesomorph': 'mesomorph', 
                'endomorph': 'endomorph',
                'ecto-meso': 'ectomorph', // Use closest match for hybrid types
                'meso-endo': 'mesomorph',
                'endo-ecto': 'endomorph'
            };
            return somatypeMapping[selectedSomatotype] || selectedSomatotype;
        }

        function categorizeFoodByMealType(foodName, foodDetails) {
            // Use Enhanced_Category and Meal_Timing from food database to determine meal type
            const mealTiming = (foodDetails.Meal_Timing || '').toLowerCase();
            const category = (foodDetails.Enhanced_Category || '').toLowerCase();
            
            // Breakfast foods
            if (mealTiming.includes('breakfast') || 
                category.includes('breakfast') ||
                category.includes('cereal') ||
                category.includes('oat') ||
                category.includes('pancake') ||
                category.includes('waffle') ||
                foodName.toLowerCase().includes('breakfast') ||
                foodName.toLowerCase().includes('cereal') ||
                foodName.toLowerCase().includes('oat')) {
                return 'breakfast';
            }
            
            // Snack foods
            if (mealTiming.includes('snack') ||
                category.includes('snack') ||
                category.includes('nuts') ||
                category.includes('seed') ||
                category.includes('cracker') ||
                category.includes('chip') ||
                foodName.toLowerCase().includes('snack') ||
                foodName.toLowerCase().includes('nuts') ||
                foodName.toLowerCase().includes('seed') ||
                foodName.toLowerCase().includes('cracker')) {
                return 'snacks';
            }
            
            // Lunch foods (typically lighter proteins, salads, sandwiches)
            if (mealTiming.includes('lunch') ||
                category.includes('salad') ||
                category.includes('sandwich') ||
                category.includes('soup') ||
                foodName.toLowerCase().includes('lunch') ||
                foodName.toLowerCase().includes('salad') ||
                foodName.toLowerCase().includes('sandwich') ||
                foodName.toLowerCase().includes('soup')) {
                return 'lunch';
            }
            
            // Dinner foods (heavier meals, main proteins)
            if (mealTiming.includes('dinner') ||
                category.includes('main') ||
                category.includes('entree') ||
                category.includes('steak') ||
                category.includes('roast') ||
                foodName.toLowerCase().includes('dinner') ||
                foodName.toLowerCase().includes('steak') ||
                foodName.toLowerCase().includes('roast')) {
                return 'dinner';
            }
            
            // Default categorization based on food type
            if (category.includes('protein') || category.includes('meat') || category.includes('fish')) {
                return Math.random() > 0.5 ? 'lunch' : 'dinner';
            }
            if (category.includes('fruit') || category.includes('dairy')) {
                return Math.random() > 0.5 ? 'breakfast' : 'snacks';
            }
            if (category.includes('vegetable') || category.includes('grain')) {
                return Math.random() > 0.5 ? 'lunch' : 'dinner';
            }
            
            // Random assignment for uncategorized foods
            const mealTypes = ['breakfast', 'lunch', 'dinner', 'snacks'];
            return mealTypes[Math.floor(Math.random() * mealTypes.length)];
        }

        function findMatchingTemplate() {
            const preferences = {
                somatotype: document.getElementById('somatotype-select').value,
                gender: document.getElementById('gender-select').value,
                goal: document.getElementById('goal-select').value,
                activity: document.getElementById('activity-select').value,
                experience: document.getElementById('experience-select').value,
                location: document.getElementById('location-select').value
            };

            // Check if all preferences are selected
            const allSelected = Object.values(preferences).every(value => value !== '');
            if (!allSelected) {
                currentTemplate = null;
                updateTemplateInfo('üîç Please select all preferences to view recommendations');
                document.getElementById('results-container').innerHTML = 
                    '<div class="loading">üìã Complete your preferences to see personalized meal recommendations...</div>';
                return;
            }

            // Map the somatotype to template values
            const mappedSomatotype = mapSomatotype(preferences.somatotype);

            // Find matching template
            const template = allTemplates.find(t => 
                t.somatotype === mappedSomatotype &&
                t.gender === preferences.gender.toLowerCase() &&
                t.goal === preferences.goal.toLowerCase() &&
                t.activity_level === preferences.activity.toLowerCase() &&
                t.experience_level === preferences.experience.toLowerCase() &&
                t.location === preferences.location.toLowerCase()
            );

            if (template) {
                currentTemplate = template;
                updateTemplateInfo(`‚úÖ Found matching template: ${template.template_id || 'Template Found'} (${preferences.somatotype})`);
                renderMealRecommendations();
            } else {
                currentTemplate = null;
                updateTemplateInfo('‚ùå No template found for these preferences. Try different combinations.');
                document.getElementById('results-container').innerHTML = 
                    '<div class="no-results">üîç No matching template found for your preferences.<br>Try adjusting your selections.</div>';
            }
        }

        function updateTemplateInfo(message) {
            document.getElementById('template-info').innerHTML = message;
        }

        function getFoodDetails(foodName) {
            const cleanName = foodName.toLowerCase().trim();
            
            // Try exact match first
            if (matchingFoods[cleanName]) {
                return matchingFoods[cleanName];
            }
            
            // Try partial matches
            for (const [dbFoodName, foodData] of Object.entries(matchingFoods)) {
                if (dbFoodName.includes(cleanName) || cleanName.includes(dbFoodName)) {
                    return foodData;
                }
            }
            
            // Return default if not found
            return {
                Food_Item: foodName,
                Enhanced_Category: 'Unknown',
                Calories_kcal: '0',
                Protein_g: '0',
                Carbohydrates_g: '0',
                Fat_g: '0'
            };
        }

        function createFoodCard(foodName) {
            const foodDetails = getFoodDetails(foodName);
            const calories = parseFloat(foodDetails.Calories_kcal) || 0;
            const protein = parseFloat(foodDetails.Protein_g) || 0;
            const carbs = parseFloat(foodDetails.Carbohydrates_g) || 0;
            const fat = parseFloat(foodDetails.Fat_g) || 0;
            const fiber = parseFloat(foodDetails.Fiber_g) || 0;
            const sugars = parseFloat(foodDetails.Sugars_g) || 0;

            return `
                <div class="food-item">
                    <div class="food-name">${foodName}</div>
                    <div class="food-category">${formatText(foodDetails.Enhanced_Category || 'Other')}</div>
                    <div class="macros-display">
                        <div class="macro-item calories-macro">
                            <div class="macro-label">Calories</div>
                            <div class="macro-value">${calories.toFixed(0)}</div>
                        </div>
                        <div class="macro-item protein-macro">
                            <div class="macro-label">Protein</div>
                            <div class="macro-value">${protein.toFixed(1)}g</div>
                        </div>
                        <div class="macro-item carbs-macro">
                            <div class="macro-label">Carbs</div>
                            <div class="macro-value">${carbs.toFixed(1)}g</div>
                        </div>
                        <div class="macro-item fat-macro">
                            <div class="macro-label">Fat</div>
                            <div class="macro-value">${fat.toFixed(1)}g</div>
                        </div>
                    </div>
                    ${fiber > 0 || sugars > 0 ? `
                        <div class="fiber-sugar-info" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 8px 0;">
                            <div class="fiber-box" style="text-align: center; padding: 6px; border-radius: 4px; background: #e8f5e8; color: #2e7d32; font-size: 10px;">
                                <strong>Fiber:</strong> ${fiber.toFixed(1)}g
                            </div>
                            <div class="sugar-box" style="text-align: center; padding: 6px; border-radius: 4px; background: #fff3e0; color: #f57c00; font-size: 10px;">
                                <strong>Sugar:</strong> ${sugars.toFixed(1)}g
                            </div>
                        </div>
                    ` : ''}
                    ${foodDetails.Meal_Timing ? `
                        <div style="text-align: center; margin-top: 8px; font-size: 10px; color: #666; font-style: italic;">
                            üïí Best timing: ${foodDetails.Meal_Timing.replace(/_/g, ' ')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function calculateMealMacros(foodsArray) {
            let totalCalories = 0, totalProtein = 0, totalCarbs = 0, totalFat = 0;
            
            foodsArray.forEach(foodName => {
                const foodDetails = getFoodDetails(foodName);
                totalCalories += parseFloat(foodDetails.Calories_kcal) || 0;
                totalProtein += parseFloat(foodDetails.Protein_g) || 0;
                totalCarbs += parseFloat(foodDetails.Carbohydrates_g) || 0;
                totalFat += parseFloat(foodDetails.Fat_g) || 0;
            });

            return {
                calories: totalCalories,
                protein: totalProtein,
                carbs: totalCarbs,
                fat: totalFat
            };
        }

        function createMealSection(mealType, foods, headerClass) {
            if (!foods || foods.length === 0) {
                return `
                    <div class="meal-section">
                        <div class="meal-header ${headerClass}">
                            ${getMealIcon(mealType)} ${formatMealName(mealType)}
                        </div>
                        <div class="meal-foods">
                            <div class="food-item">
                                <div class="food-name">No foods recommended for this meal</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            const foodCards = foods.map(createFoodCard).join('');
            const macros = calculateMealMacros(foods);
            
            return `
                <div class="meal-section">
                    <div class="meal-header ${headerClass}">
                        ${getMealIcon(mealType)} ${formatMealName(mealType)}
                        <div style="font-size: 0.9rem; margin-top: 5px; opacity: 0.9;">
                            ${foods.length} food${foods.length !== 1 ? 's' : ''}
                        </div>
                    </div>
                    <div class="meal-foods">
                        ${foodCards}
                        <div class="meal-summary">
                            <div class="summary-title">üìä Meal Totals (per 100g portions)</div>
                            <div class="summary-macros">
                                <div class="summary-macro">
                                    <div class="summary-macro-label">Calories</div>
                                    <div class="summary-macro-value">${macros.calories.toFixed(0)}</div>
                                </div>
                                <div class="summary-macro">
                                    <div class="summary-macro-label">Protein</div>
                                    <div class="summary-macro-value">${macros.protein.toFixed(1)}g</div>
                                </div>
                                <div class="summary-macro">
                                    <div class="summary-macro-label">Carbs</div>
                                    <div class="summary-macro-value">${macros.carbs.toFixed(1)}g</div>
                                </div>
                                <div class="summary-macro">
                                    <div class="summary-macro-label">Fat</div>
                                    <div class="summary-macro-value">${macros.fat.toFixed(1)}g</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getMealIcon(mealType) {
            const icons = {
                'breakfast': 'üåÖ',
                'lunch': '‚òÄÔ∏è',
                'dinner': 'üåÜ',
                'snacks': 'üçø'
            };
            return icons[mealType] || 'üçΩÔ∏è';
        }

        function formatMealName(mealType) {
            return mealType.charAt(0).toUpperCase() + mealType.slice(1);
        }

        function formatText(text) {
            return text.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function parseFoodList(foodsString) {
            if (!foodsString || foodsString.trim() === '') return [];
            return foodsString.split('|').map(food => food.trim()).filter(food => food !== '');
        }

        function renderMealRecommendations() {
            if (!currentTemplate) return;

            // Get all foods from template
            const allTemplateFoods = [
                ...parseFoodList(currentTemplate.breakfast_foods),
                ...parseFoodList(currentTemplate.lunch_foods), 
                ...parseFoodList(currentTemplate.dinner_foods),
                ...parseFoodList(currentTemplate.snack_foods)
            ];

            // Remove duplicates
            const uniqueFoods = [...new Set(allTemplateFoods)];

            // Organize foods by meal type based on their Enhanced_Category
            const organizedMeals = {
                breakfast: [],
                lunch: [],
                dinner: [],
                snacks: []
            };

            uniqueFoods.forEach(foodName => {
                const foodDetails = getFoodDetails(foodName);
                const mealType = categorizeFoodByMealType(foodName, foodDetails);
                organizedMeals[mealType].push(foodName);
            });

            // Create template details
            const templateDetails = `
                <div class="template-details">
                    <div class="template-id">üìã ${currentTemplate.template_id || 'Diet Template'}</div>
                    <div class="template-stats">
                        Target Calories: ${currentTemplate.total_calories || 'N/A'} | 
                        Protein: ${currentTemplate.protein_g || 'N/A'}g | 
                        Carbs: ${currentTemplate.carbs_g || 'N/A'}g | 
                        Fat: ${currentTemplate.fats_g || 'N/A'}g
                    </div>
                    <div style="margin-top: 10px; font-size: 12px; color: #666;">
                        üìä Total Foods: ${uniqueFoods.length} | 
                        üåÖ Breakfast: ${organizedMeals.breakfast.length} | 
                        ‚òÄÔ∏è Lunch: ${organizedMeals.lunch.length} | 
                        üåÜ Dinner: ${organizedMeals.dinner.length} | 
                        üçø Snacks: ${organizedMeals.snacks.length}
                    </div>
                </div>
            `;

            // Create meal sections
            const mealsHTML = `
                <div class="meals-container">
                    ${createMealSection('breakfast', organizedMeals.breakfast, 'breakfast-header')}
                    ${createMealSection('lunch', organizedMeals.lunch, 'lunch-header')}
                    ${createMealSection('dinner', organizedMeals.dinner, 'dinner-header')}
                    ${createMealSection('snacks', organizedMeals.snacks, 'snacks-header')}
                </div>
            `;

            document.getElementById('results-container').innerHTML = templateDetails + mealsHTML;
        }

        function setupEventListeners() {
            const selectors = ['somatotype-select', 'gender-select', 'goal-select', 'activity-select', 'experience-select', 'location-select'];
            selectors.forEach(id => {
                document.getElementById(id).addEventListener('change', findMatchingTemplate);
            });
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
